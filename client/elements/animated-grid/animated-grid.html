<dom-module id="animated-grid">
  <template>
    <style>
    :host {
      display: block;
      background: #000;
    }
    /*paper-tabs {
      height: 50px;
    }*/
    
    paper-tab {
      color: white;
    }
    
    .tile {
      display: inline-block;
      float: left;
      vertical-align: top;
      @apply(--paper-font-title);
      @apply(--layout-vertical);
      @apply(--layout-center-center);
    }
    
    .d3 {
      position: absolute;
      background: var(--google-red-100);
      height: calc(100% - 50px);
      width: 50%;
      color: red;
    }
    
    .list {
      position: absolute;
      background: var(--google-green-100);
      left: 50%;
      height: 80%;
      width: 60%;
    }
    
    .mod {
      position: absolute;
      background: var(--google-blue-100);
      top: 80%;
      left: 50%;
      bottom: 0px;
      width: 60%;
    }
    </style>
    <paper-tabs selected="{{selectedClass}}" scrollable id="classSelect" attr-for-selected="value">
      <template is="dom-repeat" items="{{classes}}">
        <paper-tab value="{{item.id}}">{{item.name}}</paper-tab>
      </template>
      <!--<paper-tab on-tap="openModal">Add class...</paper-tab>-->
      <paper-tab value="test">[[selectedClass]]</paper-tab>
    </paper-tabs>
    <div class="tile d3">
      <span>[[item.value]]</span>
    </div>
    <div class="tile list">
      <mjbe-collapse-list email="{{email}}" invitecount="{{invitecount}}"></mjbe-collapse-list>
    </div>
    <div class="tile mod">
      <span>Modifications</span>
    </div>
    <paper-dialog id="addClass" modal entry-animation="scale-up-animation" exit-animation="fade-out-animation">
      <paper-input label="Class name" value="{{classname::input}}" type="text" autofocus auto-validate minlength="2" error-message="Enter at least two characters"></paper-input>
      <paper-button raised on-tap="createClass">Enter</paper-button>
      <paper-button dialog-confirm>Cancel</paper-button>
    </paper-dialog>
  </template>
</dom-module>
<script>
Polymer({
  is: 'animated-grid',
  behaviors: [
    Polymer.NeonSharedElementAnimatableBehavior,
    Polymer.NeonAnimatableBehavior,
    Polymer.NeonAnimationRunnerBehavior
  ],
  properties: {
    loadclasses: {
      type: String,
      notify: true
    },
    classes: {
      computed: 'parseClasses(loadclasses)'
    },
    addcount: {
      notify: true,
      value: '0'
    },
    invitecount: {
      notify: true,
      value: '0'
    },
    email: {
      notify: true
    },
    classname: {
      notify: true
    },
    selectedClass: String,
    config: {
      type: Array,
      value: function() {
        return [{
          value: 1,
          color: 'blue'
        }, {
          value: 2,
          color: 'red'
        }, {
          value: 3,
          color: 'blue'
        }]
      }
    },
    animationConfig: {
      type: Object,
      value: function() {
        return {
          'entry': [{
            name: 'cascaded-animation',
            animation: 'transform-animation',
            transformFrom: 'translateY(100%)',
            transformTo: 'none',
            timing: {
              delay: 50
            }
          }],
          'toolbar': [{
            name: 'slide-down-animation',
            node: this.$.classSelect,
            timing: {
              delay: 50
            }
          }]
        }
      }
    }
  },
  attached: function() {
    this.async(function() {
      var nodeList = Polymer.dom(this.root).querySelectorAll('.tile');
      this.animationConfig['entry'][0].nodes = Array.prototype.slice.call(nodeList);
      this.playAnimation('toolbar');
      this.playAnimation('entry');
    });
  },
  parseClasses: function(classes) {
    try {
      return JSON.parse(classes);
    } catch (e) {
      return [];
    }
  },
  openModal: function() {
    this.$.addClass.open();
  },
  createClass: function() {
    console.log('polymer');
    console.log(this.classname);
    if (this.classname.length > 1) {
      this.$.addClass.close();
      this.addcount = '' + (Number.parseInt(this.addcount) + 1);
    }
  }
});
</script>
